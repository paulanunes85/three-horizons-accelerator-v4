# =============================================================================
# paulasilvatech — Agentic DevOps Platform (Backstage)
# =============================================================================
# Custom-built Backstage image with GitHub auth, catalog, scaffolder modules.
# Upstream open-source Backstage — no Red Hat registry required.
#
# Chart: backstage/backstage (https://backstage.github.io/charts)
# Image: ${PORTAL_NAME}-backstage:local (built from backstage/)
#
# Use with: PORTAL_TYPE="backstage" in local/config/local.env
# =============================================================================

backstage:
  replicas: 1

  image:
    registry: ""
    repository: paulasilvatech-backstage
    tag: local
    pullPolicy: Never

  command: ["node", "packages/backend", "--config", "app-config.yaml", "--config", "app-config.production.yaml"]

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

  extraEnvVars:
    - name: PORTAL_NAME
      value: "paulasilvatech"
    - name: APP_BASE_URL
      value: "http://localhost:7007"
    - name: GITHUB_TOKEN
      valueFrom:
        secretKeyRef:
          name: paulasilvatech-backstage-github-token
          key: token
          optional: true
    - name: POSTGRES_HOST
      value: "postgresql.databases.svc.cluster.local"
    - name: POSTGRES_PORT
      value: "5432"
    - name: POSTGRES_USER
      value: "postgres"
    - name: POSTGRES_PASSWORD
      value: "demo-postgres-2026"
    - name: GITHUB_APP_ID
      valueFrom:
        secretKeyRef:
          name: paulasilvatech-backstage-github-app
          key: app-id
          optional: true
    - name: GITHUB_APP_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: paulasilvatech-backstage-github-app
          key: client-id
          optional: true
    - name: GITHUB_APP_CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: paulasilvatech-backstage-github-app
          key: client-secret
          optional: true
    - name: GITHUB_APP_PRIVATE_KEY
      valueFrom:
        secretKeyRef:
          name: paulasilvatech-backstage-github-app
          key: private-key
          optional: true

service:
  type: NodePort
  ports:
    backend: 7007
    targetPort: backend
  nodePorts:
    backend: "30700"

postgresql:
  enabled: false  # Using external PostgreSQL from databases namespace
