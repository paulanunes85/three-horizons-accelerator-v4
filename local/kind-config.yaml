# =============================================================================
# THREE HORIZONS ACCELERATOR — kind Cluster Configuration
# =============================================================================
# Creates a multi-node cluster simulating AKS for local demonstration.
#
# Usage: kind create cluster --config local/kind-config.yaml
# =============================================================================

kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: three-horizons-demo

nodes:
  # Control Plane
  - role: control-plane
    kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            node-labels: "ingress-ready=true"
    extraPortMappings:
      # HTTP (ingress-nginx)
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      # HTTPS (ingress-nginx)
      - containerPort: 443
        hostPort: 443
        protocol: TCP
      # ArgoCD NodePort
      - containerPort: 30443
        hostPort: 8443
        protocol: TCP
      # Grafana NodePort
      - containerPort: 30300
        hostPort: 3000
        protocol: TCP
      # Prometheus NodePort
      - containerPort: 30900
        hostPort: 9090
        protocol: TCP
      # RHDH NodePort
      - containerPort: 30700
        hostPort: 7007
        protocol: TCP
      # AWX NodePort
      - containerPort: 30052
        hostPort: 8052
        protocol: TCP

  # Worker 1 — platform workloads (ArgoCD, monitoring)
  - role: worker
    labels:
      node-role: platform

  # Worker 2 — application workloads
  - role: worker
    labels:
      node-role: workloads

networking:
  podSubnet: "10.244.0.0/16"
  serviceSubnet: "10.96.0.0/16"
